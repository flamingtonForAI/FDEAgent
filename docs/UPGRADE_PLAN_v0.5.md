# FDEAgent 升级规划讨论结论

> 版本: v0.5 规划
> 日期: 2025-02-10
> 参与角色: 系统架构师、AI 产品专家、产品经理/UX 设计师

---

## 执行摘要

基于对 FDEAgent (原 Ontology Architect) 的全面分析，团队从三个维度提出了系统化的升级方案：

| 维度 | 核心目标 | 预期收益 |
|------|----------|----------|
| **多用户系统** | 从单机到 SaaS | 支持团队协作、商业化变现 |
| **AI 最大化** | 从辅助到自主 | 设计效率提升 50%+、成本降低 40% |
| **用户体验** | 从工具到平台 | 用户留存提升、移动端覆盖 |

---

## 一、产品定位升级

### 1.1 目标用户矩阵

```
                    技术深度
                       ↑
                       │
    资深架构师 ────────┼──────── AI 工程师
         │             │             │
         │     FDEAgent 核心用户     │
         │             │             │
    新手 FDE ──────────┼──────── 业务分析师
                       │
                       └──────────────→ 业务理解
```

### 1.2 价值主张演进

**当前 (v0.4)**: 智能 Ontology 设计助手
**目标 (v0.5)**: AI-Native 企业智能系统设计平台

---

## 二、多用户系统架构

### 2.1 用户体系设计

```
┌─────────────────────────────────────────────────────┐
│                   ENTERPRISE                         │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐       │
│  │ Org Owner │  │ Org Admin │  │ Billing   │       │
│  └───────────┘  └───────────┘  └───────────┘       │
├─────────────────────────────────────────────────────┤
│                      TEAM                            │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐       │
│  │ Team Lead │  │ Member    │  │ Guest     │       │
│  └───────────┘  └───────────┘  └───────────┘       │
├─────────────────────────────────────────────────────┤
│                   INDIVIDUAL                         │
│  ┌───────────┐  ┌───────────┐                      │
│  │ Pro User  │  │ Free User │                      │
│  └───────────┘  └───────────┘                      │
└─────────────────────────────────────────────────────┘
```

### 2.2 数据库模型扩展

**新增核心表:**
- `Organization` - 组织/企业
- `Team` - 团队
- `OrganizationMember` - 组织成员
- `ProjectCollaborator` - 项目协作者
- `Subscription` - 订阅计划
- `ProjectSnapshot` - 版本快照

### 2.3 计费模型

| 层级 | 价格 | 项目数 | AI 对话 | 协作者 | 特色功能 |
|------|------|--------|---------|--------|----------|
| **Free** | ¥0 | 3 | 50/月 | - | 基础功能 |
| **Pro** | ¥99/月 | 无限 | 无限 | 3人 | 完整导出、API |
| **Team** | ¥299/用户/月 | 无限 | 无限 | 无限 | 团队管理、审计 |
| **Enterprise** | 定制 | 无限 | 无限 | 无限 | SSO、私有部署 |

---

## 三、AI 能力最大化

### 3.1 AI 能力升级路线

```
Phase 1: 基础增强          Phase 2: 知识库           Phase 3: Agent 化
┌──────────────┐          ┌──────────────┐          ┌──────────────┐
│ • 智能缓存    │          │ • RAG 向量库  │          │ • 设计规划    │
│ • 模型选择    │    →     │ • 行业知识    │    →     │ • 多步骤任务  │
│ • 三层补全    │          │ • 设计模式    │          │ • 自主优化    │
│ • 冲突检测    │          │ • 最佳实践    │          │ • 协作审核    │
└──────────────┘          └──────────────┘          └──────────────┘
     1-2 个月                  2-3 个月                  3-4 个月
```

### 3.2 核心 AI 增强点

| 功能 | 当前状态 | 升级方案 | 预期收益 |
|------|----------|----------|----------|
| **对话分析** | 单轮提取 | 实时流式分析 | 即时反馈 |
| **Action 定义** | 手动填写 | 任意层自动推导 | 效率 +50% |
| **文档解析** | 附件发送 | 结构化提取 + 映射 | 精准度 +30% |
| **质量检查** | 16 条规则 | AI 深度审核 | 问题检出 +40% |
| **推荐系统** | 关键词匹配 | RAG + 个性化 | 相关性 +50% |

### 3.3 成本优化策略

```
目标: API 成本降低 40%

策略 1: 智能模型选择
┌─────────────┬─────────────┬─────────────┐
│   简单任务   │   中等任务   │   复杂任务   │
│  gpt-4o-mini │   gpt-4o    │ claude-opus │
│   $0.15/1M  │   $5/1M     │   $15/1M    │
└─────────────┴─────────────┴─────────────┘

策略 2: 三级缓存
L1 内存 (热) → L2 IndexedDB (温) → L3 Redis (冷)

策略 3: Token 优化
• 提示词压缩
• 增量上下文
• 批量处理
```

---

## 四、用户体验升级

### 4.1 用户旅程优化

**新手 FDE 旅程:**
```
首次访问 → Onboarding Tour (5步) → 选择学习路径
                                        ↓
                              ┌─────────────────┐
                              │ 边学边做模式     │
                              │ Academy + 实战   │
                              └─────────────────┘
                                        ↓
                              完成首个项目 → 成就解锁
```

**资深架构师旅程:**
```
首次访问 → 跳过引导 → 高级模式入口
                           ↓
                 ┌─────────────────┐
                 │ 批量操作工具     │
                 │ 模板定制导出     │
                 │ 版本 Diff 对比   │
                 └─────────────────┘
```

### 4.2 引导系统增强

| 场景 | 当前 | 升级 |
|------|------|------|
| 新用户 | 静态快速开始页 | 交互式 5-7 步 Tour |
| 阶段切换 | 手动导航 | 智能推荐下一步 |
| 卡住时 | 无响应 | 30s 空闲主动提示 |
| 完成时 | 无反馈 | 成就弹窗 + XP |

### 4.3 激励体系扩展

**经验值系统:**
```typescript
const XP_SOURCES = {
  completeLesson: 50,
  completeExercise: 100,
  createProject: 30,
  defineObject: 10,
  defineAction: 20,
  completeThreeLayer: 50,
  passQualityCheck: 100,
  dailyLogin: 10,
};

// 等级体系
Level 1-2: 学徒 (0-500 XP)
Level 3-4: 工程师 (500-2000 XP)
Level 5-7: 专家 (2000-5000 XP)
Level 8-10: 大师 (5000+ XP)
```

**新增成就 (15+):**
- 项目类: 首个项目、十全十美、三层大师
- 质量类: 完美设计、零警告
- 协作类: 分享达人、模板创作者

---

## 五、技术架构演进

### 5.1 前端架构

```
当前:
React 19 + Vite + localStorage
                ↓
目标:
React 19 + Vite + TanStack Query + IndexedDB + WebSocket
         │              │              │           │
         │         数据获取/缓存    离线优先     实时协作
         │
   + React Context 升级为 Zustand (可选)
```

### 5.2 后端架构

```
当前:
Fastify + Prisma + PostgreSQL (基础)
                ↓
目标:
┌─────────────────────────────────────────────────┐
│                   API Gateway                    │
│              (Fastify + Rate Limit)             │
├─────────────────────────────────────────────────┤
│     Auth      │   Projects   │   Collaboration  │
│   (JWT/SSO)   │   (CRUD)     │   (WebSocket)    │
├─────────────────────────────────────────────────┤
│                    Services                      │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
│  │   AI    │  │  Sync   │  │ Billing │         │
│  │ Service │  │ Service │  │ Service │         │
│  └─────────┘  └─────────┘  └─────────┘         │
├─────────────────────────────────────────────────┤
│     PostgreSQL     │     Redis     │   Vector   │
│    (主数据库)       │    (缓存)     │   (RAG)   │
└─────────────────────────────────────────────────┘
```

### 5.3 技术选型建议

| 组件 | 推荐方案 | 备选 |
|------|----------|------|
| 实时通信 | Socket.IO | Fastify WebSocket |
| 协同编辑 | Yjs | Automerge |
| 向量数据库 | Pinecone | Qdrant |
| Agent 框架 | LangGraph | AutoGen |
| 支付 | Stripe | 支付宝 (国内) |
| SSO | Auth0 | Okta |

---

## 六、实施路线图

### Phase 1: 基础增强 (1-2 个月)

**目标:** 夯实基础，降低成本，提升体验

| 周次 | 任务 | 负责人 | 产出 |
|------|------|--------|------|
| W1-2 | AI 智能缓存 | 后端 | 成本 -30% |
| W1-2 | 新手 Onboarding Tour | 前端 | 上手时间 -40% |
| W3-4 | 模型选择策略 | AI | 成本 -20% |
| W3-4 | 成就系统扩展 | 前端 | 留存 +10% |
| W5-6 | Action 三层智能补全 | AI | 效率 +30% |
| W5-6 | 移动端基础适配 | 前端 | 覆盖 +20% |

### Phase 2: 多用户 MVP (2-3 个月)

**目标:** 支持团队协作，启动商业化

| 周次 | 任务 | 负责人 | 产出 |
|------|------|--------|------|
| W1-3 | 数据库模型升级 | 后端 | 多用户支持 |
| W1-3 | RAG 知识库搭建 | AI | 推荐相关性 +50% |
| W4-6 | 权限系统实现 | 全栈 | 角色控制 |
| W4-6 | Level 3-4 课程 | 产品 | 学习完成率 +30% |
| W7-9 | 项目共享协作 | 全栈 | 协作功能上线 |
| W7-9 | 计费系统集成 | 后端 | 商业化 MVP |

### Phase 3: 平台化 (3-6 个月)

**目标:** 实时协作，AI Agent，企业功能

| 模块 | 功能 | 预期收益 |
|------|------|----------|
| 实时协作 | WebSocket + OT | 多人同时编辑 |
| AI Agent | 设计规划 Agent | 自动化设计 |
| 企业功能 | SSO/审计/合规 | 大客户支持 |
| 国际化 | 日语/韩语 | 海外市场 |

---

## 七、关键决策点

### 7.1 优先级决策

**Q: 先做多用户还是先做 AI 增强？**

建议: **AI 增强优先**
- 理由: AI 是核心差异化竞争力
- AI 缓存/优化可立即降低成本
- 多用户需要更多测试和运维准备

### 7.2 技术决策

**Q: 前端状态管理是否升级？**

建议: **保持 React Context，可选引入 Zustand**
- 当前架构工作良好
- 只在性能瓶颈处优化
- 避免过度工程化

**Q: 数据库是否分库分表？**

建议: **暂不需要，预留扩展点**
- 初期用户量可控
- PostgreSQL 单库可支撑 100 万+ 项目
- 通过索引优化解决大部分性能问题

### 7.3 商业决策

**Q: Free 用户是否有价值？**

建议: **保持慷慨的免费层**
- 建立用户基础和口碑
- Free → Pro 转化是增长引擎
- 限制 AI 对话数而非功能

---

## 八、风险与缓解

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| AI API 成本超支 | 高 | 中 | 缓存 + 模型选择 + 配额 |
| 实时协作复杂度 | 中 | 高 | 先 Presence，后 OT |
| 用户增长缓慢 | 高 | 中 | 社区运营 + 内容营销 |
| 大模型 API 不稳定 | 中 | 中 | 多 Provider 冗余 |
| 数据安全合规 | 高 | 低 | 审计日志 + 加密存储 |

---

## 九、成功指标 (KPIs)

### 产品指标
- **新用户激活率**: 首日完成项目 > 30%
- **7 日留存率**: > 40%
- **学习完成率**: Level 1 > 60%, Level 2 > 40%

### 技术指标
- **AI 响应时间**: P95 < 3s
- **API 成本**: 单用户月均 < ¥5
- **系统可用性**: > 99.5%

### 商业指标
- **Free → Pro 转化率**: > 5%
- **月活跃用户 (MAU)**: 6 个月 > 10,000
- **付费用户 (MRR)**: 6 个月 > ¥50,000

---

## 十、下一步行动

### 立即执行 (本周)

1. [ ] **确定 Phase 1 优先级排序**
2. [ ] **AI 缓存方案技术设计**
3. [ ] **Onboarding Tour 原型设计**
4. [ ] **成本监控 Dashboard 搭建**

### 短期准备 (2 周内)

1. [ ] **RAG 知识库内容规划**
2. [ ] **数据库扩展 Schema 设计**
3. [ ] **计费系统 Stripe 集成调研**
4. [ ] **移动端响应式审计**

---

## 附录

### A. 参考文档
- [多用户系统架构报告](#) - 系统架构师
- [AI 能力升级路线图](#) - AI 产品专家
- [用户体验升级建议](#) - 产品经理/UX

### B. 相关代码位置
- 认证系统: `contexts/AuthContext.tsx`
- 项目管理: `contexts/ProjectContext.tsx`
- AI 服务: `services/aiService.ts`
- 存储层: `lib/storage.ts`

---

**签署:**

- 系统架构师: ✓ 同意
- AI 产品专家: ✓ 同意
- 产品经理/UX: ✓ 同意

**下次评审日期:** 2025-02-24
